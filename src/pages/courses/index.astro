---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Hero from '../../components/Hero.astro';
import { getCollection } from 'astro:content';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';

const courses = await getCollection('courses');
courses.sort((a, b) => (a.data.lesson || 999) - (b.data.lesson || 999));

// Collect unique tags
const allTags = Array.from(new Set(courses.flatMap(course => course.data.tags || [])));
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<BaseHead title={`${SITE_TITLE} - Courses`} description="Learn Django, SaaS, and more with our comprehensive courses." />
		<style>
			ul {
				list-style-type: none;
				padding: unset;
			}
			ul li {
				display: flex;
			}
			ul li :global(time) {
				flex: 0 0 130px;
				font-style: italic;
				color: #595959;
			}
			ul li a:visited {
				color: #8e32dc;
			}
		</style>
	</head>
	<body class="h-screen items-center font-Verdana sans-serif text-white">
		<Header />
    <Hero />
		<main class="bg-black flex flex-col justify-center items-center">
			<section class="container mx-auto px-4 py-8">
				<h1 class="text-3xl font-bold mb-8">Courses</h1>
				<div class="mb-8 flex flex-wrap gap-2 justify-center">
					<button class="btn btn-outline btn-sm" data-filter="all">All</button>
					{allTags.map(tag => <button class="btn btn-outline btn-sm" data-filter={tag}>{tag}</button>)}
				</div>
				<ul id="courses-list">
					{courses.map((course) => (
						<li class="course-item" data-tags={course.data.tags ? course.data.tags.join(',') : ''}>
							<a href={`/courses/${course.slug}/`}>
								<h2 class="text-xl font-semibold">{course.data.title}</h2>
								<p class="text-gray-300">{course.data.description}</p>
								{course.data.tags && course.data.tags.length > 0 && (
									<div class="mt-1">
										{course.data.tags.map(tag => <span class="badge badge-outline badge-xs mr-1">{tag}</span>)}
									</div>
								)}
							</a>
							<time datetime={course.data.pubDate.toISOString()}>
								{course.data.pubDate.toLocaleDateString('en-us', {
									year: 'numeric',
									month: 'short',
									day: 'numeric',
								})}
							</time>
						</li>
					))}
				</ul>
			</section>
		</main>
		<Footer />
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const filterButtons = document.querySelectorAll('[data-filter]');
				const courseItems = document.querySelectorAll('.course-item');

				filterButtons.forEach(button => {
					button.addEventListener('click', () => {
						const filter = button.getAttribute('data-filter') || '';
						courseItems.forEach(item => {
							const tags = (item as HTMLElement).getAttribute('data-tags')?.split(',') || [];
							if (filter === 'all' || tags.includes(filter)) {
								(item as HTMLElement).style.display = 'block';
							} else {
								(item as HTMLElement).style.display = 'none';
							}
						});
						// Update active button
						filterButtons.forEach(btn => (btn as HTMLElement).classList.remove('btn-active'));
						(button as HTMLElement).classList.add('btn-active');
					});
				});
			});
		</script>
	</body>
</html>